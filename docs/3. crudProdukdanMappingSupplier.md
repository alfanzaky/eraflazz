## CRUD produk & mapping supplier:
   - Endpoint admin untuk produk dan `product_mappings`, termasuk status stok & prioritas supplier.

Saat ini belum ada lapisan usecase/handler khusus produk maupun mapping supplierâ€”API hanya punya transaksi. Untuk memenuhi kebutuhan CRUD admin produk + `product_mappings`, 

langkah implementasi:

1. **Gunakan CADANGAN modular yang sama:** buat `internal/usecase/product_uc.go` yang menggunakan [ProductRepository](cci:2://file:///home/alfanro/projects/eraflazz/internal/domain/product.go:72:0-82:1) + [ProductMappingRepository](cci:2://file:///home/alfanro/projects/eraflazz/internal/domain/product.go:85:0-94:1) existing. Fungsinya:
   - `ListProducts`, [CreateProduct](cci:1://file:///home/alfanro/projects/eraflazz/internal/domain/product.go:98:1-98:38), [UpdateProduct](cci:1://file:///home/alfanro/projects/eraflazz/internal/domain/product.go:99:1-99:49), `ToggleStatus`, `UpdateStock`.
   - `ListMappings(productID)`, `CreateMapping`, `UpdateMapping`, `DeleteMapping`, termasuk field `priority`, `stock_status`, `supplier_price`.
   - Validasi kategori/tipe/stok menggunakan helper domain.

2. **Handler admin:** buat `internal/handler/api/product_handler.go` dengan request/response DTO jelas. Pastikan setiap endpoint dilindungi [adminMiddleware()](cci:1://file:///home/alfanro/projects/eraflazz/internal/handler/api/routes.go:104:0-123:1). Endpoint minimal:
   - `POST /api/v1/admin/products`
   - `GET /api/v1/admin/products` (dengan filter provider/kategori optional)
   - `PUT /api/v1/admin/products/:id`
   - `PATCH /api/v1/admin/products/:id/status`
   - `PATCH /api/v1/admin/products/:id/stock`
   - `GET /api/v1/admin/products/:id/mappings`
   - `POST /api/v1/admin/products/:id/mappings`
   - `PUT /api/v1/admin/product-mappings/:mappingId`
   - `DELETE /api/v1/admin/product-mappings/:mappingId`

3. **Routing & wiring:** update [cmd/api/main.go](cci:7://file:///home/alfanro/projects/eraflazz/cmd/api/main.go:0:0-0:0) untuk:
   - Instantiate product usecase (butuh productRepo + productMappingRepo).
   - Buat handler & register route group `v1.Group("/admin")` dengan [authMiddleware](cci:1://file:///home/alfanro/projects/eraflazz/internal/handler/api/routes.go:57:0-102:1) + [adminMiddleware](cci:1://file:///home/alfanro/projects/eraflazz/internal/handler/api/routes.go:104:0-123:1).

4. **Smart routing sinkron:** setiap perubahan mapping (priority/stock_status) harus trigger refresh cache atau panggil `smartRoutingUsecase` update (misal simpan metrics). Untuk sementara log perbaruan sudah cukup.


## Langkah berikutnya:

1. Tambahkan pagination metadata (total count) bila dibutuhkan untuk UI admin. (selesai)

2. Pertimbangkan cache invalidation / refresh smart routing ketika mapping berubah (trigger update di smartRoutingUsecase). (selesai)

3. Mulai implementasi CRUD Product Mapping lanjutan (misal bulk import/export) jika ada requirement tambahan. (belum)

## STEP PEKERJAAN DILAKUKAN:

1. Pembaharuan awal untuk CRUD produk & mapping supplier:

    Domain produk sudah diperluas: ProductRepository kini mendukung List, UpdateStatus, UpdateStock; ProductUsecase menambahkan operasi admin seperti ListProducts, ToggleProductStatus, UpdateProductStock, dan CRUD mapping. Juga ditambahkan ProductFilter untuk query dengan kategori/provider/status @internal/domain/product.go#72-136.

2. Handler admin produk lengkap sudah dibuat dan di-wire:

    productHandler dengan endpoint create/list/detail/update/status/stock serta CRUD mapping supplier; setiap respons memakai xresponse standar dan validasi input @internal/handler/api/product_handler.go#1-309.
    productUsecase memanfaatkan ProductRepository, ProductMappingRepository, dan SupplierRepository untuk logika admin termasuk filter paging, toggle status, update stock, serta validasi mapping @internal/usecase/product_uc.go#1-204.
    Repository produk Postgres kini mendukung List, UpdateStatus, dan UpdateStock sesuai kebutuhan admin @internal/repository/postgres/product_repository.go#296-417.
    Routing /api/v1/admin/products (serta mapping) sudah terdaftar dengan authMiddleware + adminMiddleware dan handler baru diinstansiasi di cmd/api/main.go @internal/handler/api/routes.go#31-62, @cmd/api/main.go#82-138.

3. Routing & wiring untuk admin produk sudah selesai:

    cmd/api/main.go sekarang menginisialisasi productUC := usecase.NewProductUsecase(productRepo, productMappingRepo, supplierRepo) dan productHandler := apihandler.NewProductHandler(productUC) sebelum memanggil SetupRoutes @cmd/api/main.go#75-138.
    routes.go menerima handler baru dan menambahkan group /api/v1/admin/products (beserta /product-mappings) dengan kombinasi authMiddleware() + adminMiddleware() @internal/handler/api/routes.go#12-62.

4. Pagination meta untuk daftar produk admin sudah aktif:

    ProductRepository kini menyediakan List + Count dengan filter fleksibel (kategori, provider, status, query) serta limit/offset yang rapi @internal/repository/postgres/product_repository.go#296-417.
    Kontrak ProductUsecase & implementasinya diperbarui supaya ListProducts mengembalikan (items, total); handler admin menggunakan xresponse.Paginated sehingga UI punya total & total_pages @internal/domain/product.go#101-115, @internal/usecase/product_uc.go#117-130, @internal/handler/api/product_handler.go#170-201.
    
5. Sinkronisasi smart routing sudah diterapkan saat mapping berubah:

    productUsecase kini menerima dependency smartRoutingUC dan menyimpannya @internal/usecase/product_uc.go#13-32.
    Setelah CreateProductMapping, UpdateProductMapping, maupun DeleteProductMapping, kita memanggil refreshRoutingCache() yang memanfaatkan smartRoutingUC untuk memaksa pembacaan ulang supplier terbaik, sembari log warning bila refresh gagal @internal/usecase/product_uc.go#178-258.
    Konstruktor NewProductUsecase plus wiring di cmd/api/main.go sudah diperbarui agar smart routing otomatis disuntikkan (lihat @internal/usecase/product_uc.go#20-32 dan @cmd/api/main.go#75-138).

6. Constructor call di cmd/api/main.go sudah diperbaiki: NewProductUsecase kini menerima smartRoutingUC sebagai argumen terakhir, sesuai signature terbaru. 
